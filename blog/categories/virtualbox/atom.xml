<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: VirtualBox | Duff Qiu's Blog]]></title>
  <link href="http://duffqiu.github.io/blog/categories/virtualbox/atom.xml" rel="self"/>
  <link href="http://duffqiu.github.io/"/>
  <updated>2015-02-05T13:31:31+08:00</updated>
  <id>http://duffqiu.github.io/</id>
  <author>
    <name><![CDATA[Duff Qiu]]></name>
    <email><![CDATA[duffqiu@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[安装附属包失败后修复virtualbox上的centos]]></title>
    <link href="http://duffqiu.github.io/blog/2015/02/02/fix-centos-virtualbox/"/>
    <updated>2015-02-02T16:45:25+08:00</updated>
    <id>http://duffqiu.github.io/blog/2015/02/02/fix-centos-virtualbox</id>
    <content type="html"><![CDATA[<h3 id="section">原由</h3>
<hr />
<p>在virtualbox安装好centos7后，共享windows下的目录以及在host机器作拷贝张贴都不行，总是提示virtualbox的附属包没有安装，所以重新进行了安装。
但是重装时发现virtualboxguess module（vboxguest）没有安装成功，提示需要安装kernel-develp包，然后再重装这个附属包。
按照提示用<code>sudo yum install kernel-develop</code>, 然后再重装这个附属包
重新启动后竟然网卡无法使用了，同时也无法mount cdrom来卸载这个virtualbox的附属包。</p>

<p>网卡提示的错误信息是：</p>

<p>```
11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain network[2920]: RTNETLINK answers: File exists</p>

<p>11月 05 15:30:10 localhost.localdomain systemd[1]: network.service: control process exited, code=exited status=1</p>

<p>11月 05 15:30:10 localhost.localdomain systemd[1]: Failed to start LSB: Bring up/down networking.</p>

<p>11月 05 15:30:10 localhost.localdomain systemd[1]: Unit network.service entered failed state.
```</p>

<p>Google了半天都没有办法，唯一能定位的地方是virtualbox修改了kernel的module造成</p>

<h3 id="section-1">解决办法</h3>
<hr />

<p>kernel的module一般都要通过原码的方式在本地编译后安装/加载，所以才需要kernel-develop的rpm包，难道问题在这里？
通过命令<code>rpm -qa|grep kernel</code>查看安装了的包，竟然发现有两个不同的版本的kernel-develop
那么可能的问题就出在了版本上
那就需要将不对的kernel-develop rpm包卸载掉并将对应的module删除后重新编印virtualbox的module
方法如下：</p>

<ul>
  <li>删除对应的编译需要的lib库： <code>sudo rm /lib/modules/3.10.0-123.el7.x86_64/misc/vbox*</code></li>
  <li>重建modules.dep和map文件: <code>sudo depmod -a</code></li>
  <li>重新加载module: <code>sudo modprobe module</code></li>
  <li>reboot</li>
  <li>这个时候应该cdroom和网卡都回来了</li>
  <li>重新安装virtualbox的附属包</li>
</ul>

<h3 id="section-2">总结</h3>

<p>对于需要影响到kernel的安装的时候， 最好先备份一次VM，避免因为kernel被破坏后难以恢复的问题
对于需要编译kernel module的时候，先查一下已经安装的kernel的开发包有没有多个名称相同但是版本不同的包，如果有则需要删除重复的 
从过程来看，修复是很快的，但是找到问题的根源是复杂的。google也不是万能的。</p>

<p>特定申明：该版权是<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#032;&#115;&#101;&#097;&#110;&#046;&#103;&#111;&#110;&#103;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;">Junjun</a>的 -:)</p>

]]></content>
  </entry>
  
</feed>
